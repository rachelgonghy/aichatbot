
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Education & Career Guidance Assistant</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom": "https://esm.sh/react-dom@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "@google/genai": "https://esm.sh/@google/genai@1.39.0",
    "htm": "https://esm.sh/htm@3.1.1",
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
    "react/": "https://esm.sh/react@^19.2.4/"
  }
}
</script>
  <style>
    ::-webkit-scrollbar { width: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
    ::-webkit-scrollbar-thumb:hover { background: #cbd5e1; }
    body { overflow: hidden; margin: 0; padding: 0; height: 100vh; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
    .message-appear { animation: slideUp 0.3s ease-out forwards; }
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
<link rel="stylesheet" href="/index.css">
</head>
<body>
  <div id="root"></div>

  <script type="module">
    import React, { useState, useRef, useEffect } from 'react';
    import { createRoot } from 'react-dom/client';
    import { GoogleGenAI } from "@google/genai";
    import htm from 'htm';

    const html = htm.bind(React.createElement);
    const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });

    // --- ChatMessage Component ---
    const ChatMessage = ({ message }) => {
      const isUser = message.role === 'user';
      return html`
        <div className=${`flex w-full mb-4 ${isUser ? 'justify-end' : 'justify-start'} message-appear`}>
          <div className=${`max-w-[85%] rounded-2xl px-4 py-2.5 shadow-sm ${
            isUser ? 'bg-blue-600 text-white rounded-tr-none' : 'bg-white border border-gray-100 text-gray-800 rounded-tl-none'
          }`}>
            ${message.attachments?.length > 0 && html`
              <div className="mb-2 flex flex-wrap gap-2">
                ${message.attachments.map((att, idx) => html`
                  <img key=${idx} src=${att.url} className="max-h-40 rounded-lg border border-black/5" />
                `)}
              </div>
            `}
            <div className="text-sm whitespace-pre-wrap leading-relaxed">${message.text}</div>
            <div className=${`text-[9px] mt-1 opacity-60 ${isUser ? 'text-right' : 'text-left'}`}>
              ${new Date(message.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
            </div>
          </div>
        </div>
      `;
    };

    // --- Main App Component ---
    const App = () => {
      const [messages, setMessages] = useState([{
        id: '1', role: 'model', text: "Hello! I'm your Education & Career Guidance Assistant. How can I help you explore your potential today?", timestamp: new Date()
      }]);
      const [input, setInput] = useState('');
      const [isTyping, setIsTyping] = useState(false);
      const [attachments, setAttachments] = useState([]);
      const scrollRef = useRef(null);
      const fileRef = useRef(null);

      useEffect(() => {
        if (scrollRef.current) scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
      }, [messages]);

      const handleFile = (e) => {
        const files = Array.from(e.target.files);
        files.forEach(file => {
          const reader = new FileReader();
          reader.onload = (ev) => {
            setAttachments(prev => [...prev, {
              url: URL.createObjectURL(file),
              data: ev.target.result.split(',')[1],
              mimeType: file.type
            }]);
          };
          reader.readAsDataURL(file);
        });
      };

      const sendMessage = async (e) => {
        e.preventDefault();
        if ((!input.trim() && attachments.length === 0) || isTyping) return;

        const userMsg = { id: Date.now().toString(), role: 'user', text: input, attachments: [...attachments], timestamp: new Date() };
        setMessages(prev => [...prev, userMsg]);
        setInput('');
        setAttachments([]);
        setIsTyping(true);

        const botId = (Date.now() + 1).toString();
        setMessages(prev => [...prev, { id: botId, role: 'model', text: '', timestamp: new Date(), isStreaming: true }]);

        try {
          const chat = ai.chats.create({ 
            model: 'gemini-3-flash-preview',
            config: { systemInstruction: "You are an expert Education & Career Guidance Assistant. Provide professional, concise, and accurate advice on academic choices, career paths, and job searching." }
          });
          
          const result = await chat.sendMessageStream({ message: userMsg.text });
          let fullText = "";
          for await (const chunk of result) {
            fullText += chunk.text;
            setMessages(prev => prev.map(m => m.id === botId ? { ...m, text: fullText } : m));
          }
        } catch (err) {
          setMessages(prev => prev.map(m => m.id === botId ? { ...m, text: "Error connecting to service." } : m));
        } finally {
          setIsTyping(false);
          setMessages(prev => prev.map(m => m.id === botId ? { ...m, isStreaming: false } : m));
        }
      };

      return html`
        <div className="flex flex-col h-screen bg-gray-50 border-x border-gray-100 max-w-2xl mx-auto shadow-xl">
          <header className="px-4 py-3 border-b bg-white flex items-center justify-between sticky top-0 z-10">
            <div className="flex items-center gap-2 overflow-hidden">
              <div className="w-8 h-8 bg-blue-600 rounded-lg flex-shrink-0 flex items-center justify-center shadow-md">
                <i className="fa-solid fa-graduation-cap text-white text-sm"></i>
              </div>
              <span className="font-bold text-gray-800 truncate text-sm sm:text-base">Education & Career Guidance Assistant</span>
            </div>
            <button onClick=${() => setMessages([messages[0]])} className="text-gray-400 hover:text-red-500 transition-colors flex-shrink-0">
              <i className="fa-solid fa-trash-can text-sm"></i>
            </button>
          </header>

          <main ref=${scrollRef} className="flex-1 overflow-y-auto p-4 space-y-4">
            ${messages.map(m => html`<${ChatMessage} key=${m.id} message=${m} />`)}
            ${isTyping && !messages[messages.length-1].text && html`
              <div className="flex justify-start"><div className="bg-white p-3 rounded-2xl rounded-tl-none border border-gray-100 animate-pulse text-gray-400">...</div></div>
            `}
          </main>

          <footer className="p-3 bg-white border-t">
            ${attachments.length > 0 && html`
              <div className="flex gap-2 mb-2 overflow-x-auto pb-1">
                ${attachments.map((a, i) => html`
                  <div className="relative flex-shrink-0">
                    <img src=${a.url} className="w-12 h-12 object-cover rounded border" />
                    <button onClick=${() => setAttachments(prev => prev.filter((_, idx) => idx !== i))} className="absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-4 h-4 text-[10px] flex items-center justify-center">Ã—</button>
                  </div>
                `)}
              </div>
            `}
            <form onSubmit=${sendMessage} className="flex items-center gap-2 bg-gray-100 rounded-xl p-1.5 focus-within:ring-2 focus-within:ring-blue-100">
              <button type="button" onClick=${() => fileRef.current.click()} className="p-2 text-gray-400 hover:text-blue-600 transition-colors">
                <i className="fa-solid fa-plus"></i>
              </button>
              <input type="file" ref=${fileRef} className="hidden" multiple accept="image/*" onChange=${handleFile} />
              <input 
                value=${input} 
                onChange=${e => setInput(e.target.value)}
                placeholder="Ask about your future..."
                className="flex-1 bg-transparent border-none focus:ring-0 text-sm py-1"
              />
              <button type="submit" disabled=${isTyping} className="bg-blue-600 text-white w-8 h-8 rounded-lg flex items-center justify-center disabled:opacity-50 transition-transform active:scale-90 flex-shrink-0">
                <i className="fa-solid fa-arrow-up text-sm"></i>
              </button>
            </form>
          </footer>
        </div>
      `;
    };

    const root = createRoot(document.getElementById('root'));
    root.render(html`<${App} />`);
  </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
